---
phase: 01-quick-task-modal
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - client/src/components/forms/QuickTaskModal.jsx
  - client/src/components/forms/DateChip.jsx
  - client/src/App.jsx
  - client/src/index.css
autonomous: false

must_haves:
  truths:
    - "Manager opens the modal and sees only a title field and a 'today' chip -- no other fields visible"
    - "Manager taps the 'today' chip and an inline calendar dropdown appears"
    - "Manager toggles to 'recurring' and the modal smoothly expands to show all recurring fields"
    - "Manager creates a one-time task with just a title and date -- saves immediately, modal closes, toast appears"
    - "Enter key in title field saves the task (fastest flow: type, Enter, done)"
    - "Manager can still edit existing tasks via the old full TaskForm modal"
  artifacts:
    - path: "client/src/components/forms/QuickTaskModal.jsx"
      provides: "Minimal task creation modal with progressive disclosure"
      min_lines: 100
    - path: "client/src/components/forms/DateChip.jsx"
      provides: "Tappable date chip with inline calendar dropdown"
      min_lines: 30
  key_links:
    - from: "client/src/components/forms/QuickTaskModal.jsx"
      to: "client/src/context/AppContext.jsx"
      via: "useApp().addTask for saving tasks"
      pattern: "addTask"
    - from: "client/src/App.jsx"
      to: "client/src/components/forms/QuickTaskModal.jsx"
      via: "import and render when isTaskModalOpen && !editingTask"
      pattern: "QuickTaskModal"
    - from: "client/src/components/forms/QuickTaskModal.jsx"
      to: "react-toastify"
      via: "toast() call after successful save"
      pattern: "toast"
---

<objective>
Build the QuickTaskModal -- a Todoist-style minimal task creation experience that replaces the current full-form modal for new tasks. The modal shows only a title field + "today" date chip by default, with a radio toggle to expand into the full recurring form when needed. One-time tasks save with just title + date (defaulting to today at 09:00), and the modal closes immediately with a brief Hebrew toast confirmation.

Purpose: Transform task creation from a 10+ field intimidating form into a 2-second interaction for one-time tasks, while keeping full recurring task creation accessible via progressive disclosure.

Output: QuickTaskModal.jsx, DateChip.jsx, updated App.jsx with conditional modal rendering and ToastContainer.
</objective>

<execution_context>
@C:\Users\sarha\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\sarha\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-quick-task-modal/01-CONTEXT.md
@.planning/phases/01-quick-task-modal/01-RESEARCH.md

Key source files to reference:
@client/src/components/forms/TaskForm.jsx
@client/src/components/shared/Modal.jsx
@client/src/context/AppContext.jsx
@client/src/App.jsx
@client/src/components/forms/datepicker-custom.css
@client/src/index.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-toastify and build QuickTaskModal + DateChip components</name>
  <files>
    client/src/components/forms/QuickTaskModal.jsx
    client/src/components/forms/DateChip.jsx
  </files>
  <action>
    **Step 1: Install react-toastify**

    Run `npm install react-toastify` in the `client/` directory.

    **Step 2: Create DateChip.jsx** (`client/src/components/forms/DateChip.jsx`)

    A tappable chip component that shows a date label and opens an inline react-datepicker calendar dropdown on click.

    Props: `selectedDate` (Date), `onChange` (function receiving Date)

    Behavior:
    - Renders as a small rounded chip/badge (e.g., `bg-indigo-50 text-indigo-700 px-3 py-1 rounded-full cursor-pointer`)
    - Label logic:
      - If date is today: show "היום"
      - If date is tomorrow: show "מחר"
      - Otherwise: show formatted date `dd/MM` (e.g., "07/02")
    - On click: toggles visibility of an absolutely-positioned react-datepicker inline calendar below the chip
    - When a date is selected in the calendar: call `onChange(date)`, close the calendar
    - Click outside closes the calendar (use a ref + useEffect click-outside handler)
    - Calendar uses existing RTL styles from `datepicker-custom.css` (import it)
    - Minimum date: today (no past dates)
    - Import react-datepicker and use `inline` prop for the dropdown calendar

    **Step 3: Create QuickTaskModal.jsx** (`client/src/components/forms/QuickTaskModal.jsx`)

    A centered popup modal for quick task creation with progressive disclosure.

    Structure:
    ```
    [Backdrop: bg-black/60 backdrop-blur-sm]
      [Centered modal card: ~400px wide, bg-white rounded-2xl shadow-2xl]
        [Header: "משימה חדשה" + close X button]
        [Title input field with DateChip positioned inside on the left (RTL: left = start side)]
        [Radio toggle row: חד-פעמית (default) | חוזרת]
        [Expandable section: recurring fields from TaskForm.jsx -- uses CSS grid-template-rows 0fr/1fr transition]
        [Save button: "שמור" -- visible in both modes]
    ```

    Implementation details:

    1. **Modal wrapper**: Use same backdrop pattern as existing Modal.jsx (`fixed inset-0 z-50`). Small centered popup, NOT full-screen. Same appearance on mobile and desktop. Escape key closes. Backdrop click closes. Scroll lock on body.

    2. **Title input with DateChip inside**: The title input takes up the full width. The DateChip sits INSIDE the input container on the left side (in RTL layout, the left is the "end" side). Use a wrapper div with `relative` positioning. The input has `pe-20` (padding-end) to make room for the chip. The DateChip is positioned `absolute left-2 top-1/2 -translate-y-1/2`.

    3. **Radio toggle**: Two styled radio buttons below the title field. `חד-פעמית` is selected by default. Styling: pill-shaped toggle group (flexbox with rounded-full, selected gets `bg-gray-900 text-white`, unselected gets `bg-gray-100 text-gray-600`). On toggle, `taskMode` state switches between `'one-time'` and `'recurring'`.

    4. **Expandable recurring section**: When `taskMode === 'recurring'`, show the recurring fields with a smooth CSS grid transition. Use a wrapper div with `overflow: hidden` and `transition: grid-template-rows 300ms ease`. When collapsed: `grid-template-rows: 0fr`. When expanded: `grid-template-rows: 1fr`. Inner div has `min-height: 0`.

       Recurring fields to show (reuse the same field structure from TaskForm.jsx, not the component itself):
       - Frequency select (frequencyOptions from TaskForm)
       - Weekly days checkboxes (when frequency is 'daily')
       - Start time input (HH:MM)
       - System select (from useApp().systems)
       - Employee select (from useApp().employees)
       - Priority select (priorityOptions from TaskForm)
       - Duration input (estimated_duration_minutes, default 30)

    5. **State management**:
       - `title` (string, default '')
       - `taskMode` ('one-time' | 'recurring', default 'one-time')
       - `selectedDate` (Date, default new Date() = today)
       - `formData` object for recurring fields: `{ frequency, weekly_days, start_time, system_id, employee_id, priority, estimated_duration_minutes }`
       - `isSaving` (boolean) to prevent double-submit

    6. **Quick save flow (one-time mode)**:
       - Validate title is not empty. If empty, show subtle red border on input + shake animation (add `animate-shake` to index.css).
       - Build task object: `{ title, start_date: YYYY-MM-DD format of selectedDate, start_time: '09:00', frequency: 'one-time', is_recurring: false, priority: 'normal', estimated_duration_minutes: 30, status: 'draft' }`
       - Call `addTask(taskObject)` from useApp()
       - On success: close modal via `onClose()`, show toast "משימה נוצרה" using `toast.success('משימה נוצרה', { ... })`
       - On error: show `toast.error('שגיאה ביצירת משימה')`

    7. **Enter key handling**: On the title input, listen for `onKeyDown`. If `event.key === 'Enter'` AND `taskMode === 'one-time'`: prevent default and trigger save. Do NOT trigger Enter-save in recurring mode (user may be filling other fields).

    8. **Recurring save flow**:
       - Same validation as current TaskForm handleSubmit (title required, time required, date required for non-daily, time format validation)
       - Build full task object with all recurring fields
       - Call `addTask(taskObject)`
       - On success: close modal, show toast "משימה נוצרה"

    9. **Props**: `isOpen` (boolean), `onClose` (function)

    10. **Toast configuration**: Import `{ toast } from 'react-toastify'`. Use default positioning (will be configured globally in App.jsx).

    Do NOT use the existing Modal.jsx component -- QuickTaskModal renders its own smaller modal. The existing Modal.jsx is full-width on mobile and max-w-3xl on desktop, which is too large for this minimal popup.
  </action>
  <verify>
    - File `client/src/components/forms/QuickTaskModal.jsx` exists and exports a default function component
    - File `client/src/components/forms/DateChip.jsx` exists and exports a default function component
    - `npm ls react-toastify` in client/ shows the package is installed
    - No lint errors: `cd client && npm run lint` passes (or only pre-existing warnings)
  </verify>
  <done>
    QuickTaskModal.jsx renders a small centered popup with title input + DateChip inside, radio toggle, expandable recurring section, and save functionality. DateChip.jsx renders a tappable date chip with inline calendar. react-toastify is installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire QuickTaskModal into App.jsx and add ToastContainer</name>
  <files>
    client/src/App.jsx
    client/src/index.css
  </files>
  <action>
    **Step 1: Add shake animation to index.css**

    Add the following keyframes and utility class to `client/src/index.css`:

    ```css
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-4px); }
      75% { transform: translateX(4px); }
    }

    .animate-shake {
      animation: shake 0.3s ease-in-out;
    }
    ```

    **Step 2: Update App.jsx**

    1. Add imports at the top:
       ```javascript
       import QuickTaskModal from './components/forms/QuickTaskModal';
       import { ToastContainer } from 'react-toastify';
       import 'react-toastify/dist/ReactToastify.css';
       ```

    2. Add ToastContainer inside the MainContent return, after the closing `</div>` of the main layout but before the final closing tag. Configure it for RTL:
       ```jsx
       <ToastContainer
         position="bottom-center"
         autoClose={2000}
         hideProgressBar
         newestOnTop={false}
         closeOnClick
         rtl={true}
         pauseOnFocusLoss={false}
         draggable={false}
         pauseOnHover={false}
         theme="light"
       />
       ```

    3. Change the Global Task Modal section to use conditional rendering:
       - When `isTaskModalOpen && !editingTask` (new task): render `<QuickTaskModal isOpen={true} onClose={handleCloseTaskModal} />`
       - When `isTaskModalOpen && editingTask` (editing): render the existing `<Modal>` with `<TaskForm>` (unchanged)

       Replace:
       ```jsx
       {/* Global Task Modal */}
       <Modal
         isOpen={isTaskModalOpen}
         onClose={handleCloseTaskModal}
         title={editingTask ? 'ערוך משימה' : 'משימה חדשה'}
       >
         <TaskForm task={editingTask} onClose={handleCloseTaskModal} />
       </Modal>
       ```

       With:
       ```jsx
       {/* Quick Task Modal (new tasks) */}
       {isTaskModalOpen && !editingTask && (
         <QuickTaskModal isOpen={true} onClose={handleCloseTaskModal} />
       )}

       {/* Edit Task Modal (existing tasks) */}
       {isTaskModalOpen && editingTask && (
         <Modal
           isOpen={true}
           onClose={handleCloseTaskModal}
           title="ערוך משימה"
         >
           <TaskForm task={editingTask} onClose={handleCloseTaskModal} />
         </Modal>
       )}
       ```

    This preserves the ability to edit tasks (MODAL-06) while replacing new task creation with the quick modal.
  </action>
  <verify>
    - `cd client && npm run build` succeeds without errors
    - App.jsx imports QuickTaskModal and ToastContainer
    - App.jsx renders QuickTaskModal when isTaskModalOpen && !editingTask
    - App.jsx renders old Modal+TaskForm when isTaskModalOpen && editingTask
    - index.css contains animate-shake keyframes
  </verify>
  <done>
    App.jsx uses QuickTaskModal for new task creation and the existing Modal+TaskForm for editing. ToastContainer is configured with RTL support and bottom-center positioning. Shake animation is available in CSS.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete QuickTaskModal implementation:
    1. New QuickTaskModal component with minimal title + date chip layout
    2. DateChip component with inline calendar dropdown
    3. Radio toggle between one-time and recurring modes
    4. CSS grid smooth expansion for recurring fields
    5. Enter key quick-save for one-time tasks
    6. Toast notification after save
    7. Conditional rendering in App.jsx (QuickTaskModal for new, old form for edit)
  </what-built>
  <how-to-verify>
    Start the dev server: `npm run dev` from the project root.

    **Test 1 - Minimal layout (MODAL-01):**
    1. Click the "+" / "משימה חדשה" button in the sidebar (desktop) or navigate to a page with add button
    2. Verify: Small centered popup appears with ONLY a title field and a "היום" chip -- no system, employee, frequency, or other fields visible
    3. Verify: "חד-פעמית" radio is selected by default

    **Test 2 - Date chip (MODAL-02):**
    1. Click the "היום" chip
    2. Verify: An inline calendar appears below the chip
    3. Select a different date (e.g., tomorrow)
    4. Verify: Chip text changes to "מחר" or the date format
    5. Click the chip again, select today
    6. Verify: Chip text returns to "היום"

    **Test 3 - Recurring mode (MODAL-03, MODAL-05):**
    1. Click "חוזרת" radio button
    2. Verify: Modal smoothly expands to show frequency, days, time, system, employee, priority, duration fields
    3. Click "חד-פעמית" to toggle back
    4. Verify: Modal collapses back to minimal layout

    **Test 4 - Quick save (MODAL-04):**
    1. Type a task title (e.g., "בדיקת מערכת")
    2. Press Enter
    3. Verify: Modal closes, toast "משימה נוצרה" appears briefly
    4. Verify: Task appears in the task list for today
    5. Verify: Task was created with default time 09:00 and no system/employee

    **Test 5 - Edit existing task (MODAL-06):**
    1. Click edit on an existing task
    2. Verify: The OLD full-form modal opens (not the quick modal)
    3. Verify: All fields are populated and editable
    4. Verify: Can assign an employee and save

    **Test 6 - Mobile:**
    1. Resize browser to mobile width (< 1024px)
    2. Tap the add task button
    3. Verify: Same centered popup appears (not full-screen)
    4. Verify: Touch targets are adequate
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:
1. `cd client && npm run build` succeeds
2. `cd client && npm run lint` passes (or only pre-existing warnings)
3. New task creation uses QuickTaskModal (minimal layout)
4. Editing existing tasks uses old Modal+TaskForm
5. Toast notifications appear in Hebrew with RTL
6. CSS grid transition is smooth (no jumps)
7. Enter key saves one-time tasks immediately
8. Date chip shows "היום" by default, calendar appears on click
</verification>

<success_criteria>
- MODAL-01: Modal opens with title field + "today" chip only
- MODAL-02: "Today" chip tappable, opens inline date picker
- MODAL-03: Radio toggle between one-time and recurring
- MODAL-04: One-time saves with title + date only (no system/employee required)
- MODAL-05: Recurring mode expands to show all fields
- MODAL-06: Existing tasks editable via old full form (can add employee later)
</success_criteria>

<output>
After completion, create `.planning/phases/01-quick-task-modal/01-01-SUMMARY.md`
</output>
