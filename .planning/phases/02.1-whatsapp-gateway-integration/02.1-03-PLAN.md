---
phase: 02.1-whatsapp-gateway-integration
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - render-build.sh
autonomous: true

must_haves:
  truths:
    - "Render deployment successfully installs Puppeteer Chrome"
    - "render-build.sh script is executable"
    - "Build command documented for Render dashboard"
  artifacts:
    - path: "render-build.sh"
      provides: "Puppeteer Chrome installation for Render"
      min_lines: 5
  key_links:
    - from: "render-build.sh"
      to: "Puppeteer"
      via: "npx puppeteer browsers install chrome"
      pattern: "puppeteer browsers install"
---

<objective>
Create the Render deployment build script to ensure Puppeteer Chrome is available.

Purpose: Without this script, WhatsApp client fails on Render with "Browser was not found" error because Puppeteer cache is not preserved.

Output: render-build.sh script ready for Render deployment.
</objective>

<execution_context>
@C:\Users\sarha\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\sarha\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02.1-whatsapp-gateway-integration/02.1-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create render-build.sh for Puppeteer on Render</name>
  <files>render-build.sh</files>
  <action>
Create render-build.sh in project root with the following content:

```bash
#!/usr/bin/env bash
# Render build script for Puppeteer/whatsapp-web.js
# This ensures Chrome is installed in a persistent location

set -o errexit

echo "=== Eden Build Script for Render ==="

# Install npm dependencies
echo "Installing npm dependencies..."
npm install

# Install Puppeteer Chrome to a persistent cache location
# Render's /opt/render/.cache is preserved between deploys
echo "Installing Puppeteer Chrome..."
PUPPETEER_CACHE_DIR=/opt/render/.cache/puppeteer
mkdir -p $PUPPETEER_CACHE_DIR
npx puppeteer browsers install chrome

echo "=== Build complete ==="
```

This script:
1. Uses strict error handling (errexit)
2. Installs npm dependencies
3. Creates Puppeteer cache directory in Render's persistent location
4. Installs Chrome browser for Puppeteer

After creating the file, make it executable:
```bash
git add render-build.sh
git update-index --chmod=+x render-build.sh
```

Note: On Windows, the chmod doesn't apply locally, but git will track the executable permission for Unix systems (like Render).
  </action>
  <verify>
    - render-build.sh exists in project root
    - File contains set -o errexit
    - File contains PUPPETEER_CACHE_DIR=/opt/render/.cache/puppeteer
    - File contains npx puppeteer browsers install chrome
    - Git tracks executable permission: git ls-files -s render-build.sh shows 100755
  </verify>
  <done>
    render-build.sh ready for Render deployment with Puppeteer Chrome installation
  </done>
</task>

</tasks>

<verification>
1. render-build.sh exists in project root
2. Script has correct shebang and error handling
3. Script installs to /opt/render/.cache/puppeteer
4. Git tracks file as executable
</verification>

<success_criteria>
- [ ] render-build.sh created in project root
- [ ] Script has bash shebang and errexit
- [ ] PUPPETEER_CACHE_DIR set to /opt/render/.cache/puppeteer
- [ ] npx puppeteer browsers install chrome command present
- [ ] Git executable bit set (100755)
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-whatsapp-gateway-integration/02.1-03-SUMMARY.md`
</output>
