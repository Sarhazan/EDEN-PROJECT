---
phase: 05-multi-language-support
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - server/services/i18n.js
  - src/locales/he/common.json
  - src/locales/he/tasks.json
  - src/locales/he/whatsapp.json
  - src/locales/en/common.json
  - src/locales/en/tasks.json
  - src/locales/en/whatsapp.json
  - src/locales/ru/common.json
  - src/locales/ru/tasks.json
  - src/locales/ru/whatsapp.json
  - src/locales/ar/common.json
  - src/locales/ar/tasks.json
  - src/locales/ar/whatsapp.json
autonomous: true

must_haves:
  truths:
    - "Server can translate strings to 4 languages (he, en, ru, ar)"
    - "Translation files contain all UI strings with proper interpolation"
    - "i18n service provides thread-safe translation for concurrent employee requests"
  artifacts:
    - path: "server/services/i18n.js"
      provides: "Server-side i18next configuration and translation functions"
      exports: ["t", "changeLanguage", "getFixedT"]
    - path: "src/locales/he/tasks.json"
      provides: "Hebrew translations for task-related strings"
      contains: "pageTitle"
    - path: "src/locales/en/tasks.json"
      provides: "English translations for task-related strings"
      contains: "pageTitle"
    - path: "src/locales/ru/tasks.json"
      provides: "Russian translations for task-related strings"
      contains: "pageTitle"
    - path: "src/locales/ar/tasks.json"
      provides: "Arabic translations for task-related strings"
      contains: "pageTitle"
  key_links:
    - from: "server/services/i18n.js"
      to: "src/locales/*/tasks.json"
      via: "i18next-fs-backend loadPath"
      pattern: "loadPath.*locales/\\{\\{lng\\}\\}/\\{\\{ns\\}\\}\\.json"
---

<objective>
Install and configure i18next for server-side internationalization (i18n) infrastructure.

Purpose: Establish the foundation for multi-language support across WhatsApp messages, interactive HTML pages, and UI components. This enables the system to serve content in Hebrew, English, Russian, and Arabic based on employee language preference.

Output: Fully configured i18next service with translation files for 4 languages (Hebrew, English, Russian, Arabic) and 3 namespaces (common, tasks, whatsapp).
</objective>

<execution_context>
@c:\dev\projects\claude projects\eden claude\.claude\get-shit-done\workflows\execute-plan.md
@c:\dev\projects\claude projects\eden claude\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@c:\dev\projects\claude projects\eden claude\.planning\PROJECT.md
@c:\dev\projects\claude projects\eden claude\.planning\ROADMAP.md
@c:\dev\projects\claude projects\eden claude\.planning\STATE.md
@c:\dev\projects\claude projects\eden claude\.planning\phases\05-multi-language-support\05-RESEARCH.md

# Existing patterns
@c:\dev\projects\claude projects\eden claude\server\services\whatsapp.js
@c:\dev\projects\claude projects\eden claude\server\services\htmlGenerator.js
</context>

<tasks>

<task type="auto">
  <name>Install i18next dependencies</name>
  <files>package.json</files>
  <action>
Install i18next core and server-side backend:
- i18next: Core i18n framework (23.x)
- i18next-fs-backend: Filesystem loader for Node.js server-side translations (2.x)

Commands:
```bash
cd "c:\dev\projects\claude projects\eden claude"
npm install i18next i18next-fs-backend --save
```

Do NOT install react-i18next or i18next-http-backend - manager UI stays Hebrew-only (no client-side i18n needed).
  </action>
  <verify>
```bash
npm list i18next i18next-fs-backend
```
Both packages should appear in dependencies with versions matching installation.
  </verify>
  <done>package.json contains i18next and i18next-fs-backend in dependencies section.</done>
</task>

<task type="auto">
  <name>Create translation JSON files</name>
  <files>
    src/locales/he/common.json
    src/locales/he/tasks.json
    src/locales/he/whatsapp.json
    src/locales/en/common.json
    src/locales/en/tasks.json
    src/locales/en/whatsapp.json
    src/locales/ru/common.json
    src/locales/ru/tasks.json
    src/locales/ru/whatsapp.json
    src/locales/ar/common.json
    src/locales/ar/tasks.json
    src/locales/ar/whatsapp.json
  </files>
  <action>
Create translation files for 4 languages (he, en, ru, ar) with 3 namespaces (common, tasks, whatsapp).

Structure:
```
src/locales/
├── he/ (Hebrew)
│   ├── common.json (shared UI strings)
│   ├── tasks.json (interactive page strings)
│   └── whatsapp.json (WhatsApp message templates)
├── en/ (English)
│   ├── common.json
│   ├── tasks.json
│   └── whatsapp.json
├── ru/ (Russian)
│   ├── common.json
│   ├── tasks.json
│   └── whatsapp.json
└── ar/ (Arabic)
    ├── common.json
    ├── tasks.json
    └── whatsapp.json
```

**tasks.json** (all languages) must contain:
- pageTitle: "Tasks to Complete" / "משימות לביצוע" / "Задачи для выполнения" / "المهام المطلوب إكمالها"
- greeting: "Hello {{name}}" / "שלום {{name}}" / "Привет {{name}}" / "مرحبا {{name}}"
- acknowledgeButton: "Acknowledge Receipt of All Tasks" / "אישור קבלת כל המשימות" / etc.
- acknowledgeDescription: Explanation of acknowledgement button
- completeButton: "Submit Completion" / "שלח השלמה" / etc.
- addNoteLabel: "Notes (optional)" / "הערות (אופציונלי)" / etc.
- addNotePlaceholder: Placeholder for note textarea
- uploadImageLabel: "Upload Image" / "צלם תמונה" / etc.
- uploadImageHint: "Up to 5MB, JPG or PNG only" / etc.
- taskCompleted: Success message after completion
- priority.urgent/normal/optional: Priority levels
- badge.time/duration/completed: Badge labels

**whatsapp.json** (all languages) must contain:
- greeting: "Hello {{name}}" with appropriate formality per language
- taskListHeader: "Tasks for {{date}}" / "משימות ליום {{date}}" / etc.
- time: "Time" / "שעה" / "Время" / "الوقت"
- description: "Description" / "תיאור" / "Описание" / "الوصف"
- clickToView: "Click the link below to view and confirm" / etc.

**common.json** (all languages):
- Can be empty {} for now (reserved for future manager UI translations)

Use interpolation syntax: `{{variableName}}` for dynamic values.
Maintain natural word order per language (don't translate word-by-word).
Arabic and Russian text can be 20-30% longer - ensure translations are concise.
  </action>
  <verify>
```bash
ls "c:\dev\projects\claude projects\eden claude\src\locales\he"
ls "c:\dev\projects\claude projects\eden claude\src\locales\en"
ls "c:\dev\projects\claude projects\eden claude\src\locales\ru"
ls "c:\dev\projects\claude projects\eden claude\src\locales\ar"
```
Each directory should contain common.json, tasks.json, whatsapp.json.

Validate JSON syntax:
```bash
node -e "console.log(require('./src/locales/he/tasks.json'))"
node -e "console.log(require('./src/locales/en/tasks.json'))"
```
Should output parsed JSON without errors.
  </verify>
  <done>12 translation files created (4 languages × 3 namespaces), all valid JSON, containing required keys with appropriate translations.</done>
</task>

<task type="auto">
  <name>Create server-side i18n service</name>
  <files>server/services/i18n.js</files>
  <action>
Create i18next configuration service for server-side translations.

File: `server/services/i18n.js`

Pattern from RESEARCH.md "Complete i18next Setup for Node.js Backend":
- Use i18next-fs-backend for file loading
- Set fallbackLng to 'he' (Hebrew default)
- Support 4 languages: he, en, ru, ar
- Load from src/locales/{{lng}}/{{ns}}.json
- Export: t (translation function), changeLanguage, getFixedT

Key requirements:
- Use `require('i18next')` and `require('i18next-fs-backend')` (CommonJS, not ESM)
- Path: `path.join(__dirname, '../../src/locales/{{lng}}/{{ns}}.json')`
- Set `interpolation.escapeValue: false` (server-side, no XSS risk)
- Namespaces: ['common', 'tasks', 'whatsapp']
- defaultNS: 'common'
- saveMissing: false (don't auto-create missing keys in production)

Export module with:
```javascript
module.exports = {
  t: (key, options) => i18next.t(key, options),
  changeLanguage: (lng) => i18next.changeLanguage(lng),
  getFixedT: (lng, ns) => i18next.getFixedT(lng, ns)
};
```

getFixedT is critical - it locks language for a specific rendering context (prevents race conditions when serving multiple employees concurrently).
  </action>
  <verify>
Test loading service and translating:
```bash
node -e "
const i18n = require('./server/services/i18n.js');
setTimeout(async () => {
  await i18n.changeLanguage('en');
  console.log('EN greeting:', i18n.t('tasks:greeting', { name: 'John' }));
  await i18n.changeLanguage('he');
  console.log('HE greeting:', i18n.t('tasks:greeting', { name: 'ישראל' }));
  await i18n.changeLanguage('ru');
  console.log('RU greeting:', i18n.t('tasks:greeting', { name: 'Иван' }));
}, 500);
"
```
Should output greetings in English, Hebrew, and Russian with interpolated names.
  </verify>
  <done>server/services/i18n.js exists, exports t/changeLanguage/getFixedT functions, successfully loads and translates strings from all 4 language files.</done>
</task>

</tasks>

<verification>
Run comprehensive i18n infrastructure verification:

1. **Dependencies installed:**
   ```bash
   npm list i18next i18next-fs-backend
   ```

2. **Translation files exist and valid:**
   ```bash
   for lang in he en ru ar; do
     echo "Checking $lang..."
     node -e "console.log(Object.keys(require('./src/locales/$lang/tasks.json')))"
   done
   ```

3. **i18n service functional:**
   ```bash
   node -e "
   const i18n = require('./server/services/i18n.js');
   setTimeout(async () => {
     for (const lng of ['he', 'en', 'ru', 'ar']) {
       const t = i18n.getFixedT(lng, 'tasks');
       console.log(lng + ':', t('pageTitle'));
     }
   }, 500);
   "
   ```
   Should print page titles in all 4 languages.

4. **Interpolation works:**
   ```bash
   node -e "
   const i18n = require('./server/services/i18n.js');
   setTimeout(() => {
     const t = i18n.getFixedT('en', 'whatsapp');
     console.log(t('greeting', { name: 'Test User' }));
   }, 500);
   "
   ```
   Should output: "Hello Test User" (or equivalent English greeting).
</verification>

<success_criteria>
1. i18next and i18next-fs-backend installed in package.json
2. 12 translation JSON files created (4 languages × 3 namespaces)
3. All JSON files valid and contain required keys
4. server/services/i18n.js exists and exports t, changeLanguage, getFixedT
5. i18n service successfully loads translations from filesystem
6. Translations work for all 4 languages (he, en, ru, ar)
7. Interpolation works ({{name}} replaced correctly)
8. getFixedT locks language context for concurrent requests
</success_criteria>

<output>
After completion, create `.planning/phases/05-multi-language-support/05-01-SUMMARY.md`

Document:
- i18next version installed
- Translation file structure (4 languages, 3 namespaces)
- i18n service API (t, changeLanguage, getFixedT)
- Example translations for each language
- Next steps: Use i18n service in HTML generator and WhatsApp service
</output>
