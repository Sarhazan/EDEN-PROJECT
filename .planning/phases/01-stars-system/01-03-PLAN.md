---
phase: 01-stars-system
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - client/src/components/layout/Sidebar.jsx
  - client/src/pages/MyDayPage.jsx
  - client/src/pages/AllTasksPage.jsx
  - client/src/pages/HistoryPage.jsx
autonomous: true

must_haves:
  truths:
    - "User sees star filter button in sidebar"
    - "Clicking filter button toggles between 'all' and 'starred only' modes"
    - "Starred-only filter excludes completed tasks automatically"
    - "Filter state persists across page navigation"
    - "Filter state persists across browser refresh"
  artifacts:
    - path: "client/src/components/layout/Sidebar.jsx"
      provides: "Star filter toggle button"
      min_lines: 15
    - path: "client/src/pages/MyDayPage.jsx"
      provides: "Client-side filtering logic"
      min_lines: 10
  key_links:
    - from: "client/src/components/layout/Sidebar.jsx"
      to: "localStorage"
      via: "setItem/getItem for filter state"
      pattern: "localStorage\\.(get|set)Item.*starFilter"
    - from: "client/src/pages/MyDayPage.jsx"
      to: "tasks.filter()"
      via: "is_starred check"
      pattern: "filter.*is_starred"
---

<objective>
Add global star filter in sidebar with localStorage persistence

Purpose: Allow managers to focus on important tasks by filtering out unstarred items
Output: Sidebar filter button + client-side filtering across all pages
</objective>

<execution_context>
@c:\dev\projects\claude projects\eden claude\.claude\get-shit-done\workflows\execute-plan.md
@c:\dev\projects\claude projects\eden claude\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@c:\dev\projects\claude projects\eden claude\.planning\PROJECT.md
@c:\dev\projects\claude projects\eden claude\.planning\ROADMAP.md
@c:\dev\projects\claude projects\eden claude\.planning\STATE.md
@c:\dev\projects\claude projects\eden claude\.planning\phases\01-stars-system\01-CONTEXT.md

# Dependencies from prior plans
@c:\dev\projects\claude projects\eden claude\.planning\phases\01-stars-system\01-01-SUMMARY.md
@c:\dev\projects\claude projects\eden claude\.planning\phases\01-stars-system\01-02-SUMMARY.md

# Existing components
@c:\dev\projects\claude projects\eden claude\client\src\components\layout\Sidebar.jsx
@c:\dev\projects\claude projects\eden claude\client\src\pages\MyDayPage.jsx
@c:\dev\projects\claude projects\eden claude\client\src\pages\AllTasksPage.jsx
@c:\dev\projects\claude projects\eden claude\client\src\pages\HistoryPage.jsx
</context>

<tasks>

<task type="auto">
  <name>Add star filter button to Sidebar</name>
  <files>client/src/components/layout/Sidebar.jsx</files>
  <action>
Add star filter toggle button in Sidebar with localStorage persistence.

Implementation:
- Import FaStar (filled) and FaRegStar (outline) from react-icons/fa
- Add state: `const [starFilter, setStarFilter] = useState(false)`
- Initialize from localStorage on mount:
  ```javascript
  useEffect(() => {
    const saved = localStorage.getItem('starFilter');
    if (saved !== null) setStarFilter(saved === 'true');
  }, []);
  ```
- Save to localStorage on change:
  ```javascript
  const handleStarFilterToggle = () => {
    const newValue = !starFilter;
    setStarFilter(newValue);
    localStorage.setItem('starFilter', newValue.toString());
  };
  ```
- Position button below navigation items, above logout button
- Icon: FaStar if active (gold text-yellow-500), FaRegStar if inactive (gray text-gray-400)
- Hover state: hover:bg-indigo-50 (consistent with nav items)
- Active state: bg-indigo-100 when filter enabled
- Tooltip/title: "סינון משימות מסומנות בכוכב"

Why this approach:
- localStorage persists filter state across sessions
- Boolean state is simple (true = starred only, false = all)
- Icon-only button (no text) keeps sidebar clean per CONTEXT.md decision
- Gold/gray matches star icon on cards (visual consistency)
- Positioned in sidebar for global scope (applies across all pages)
  </action>
  <verify>
Test in browser:
1. Click star button in sidebar - turns gold, active state
2. Refresh page - button stays gold (localStorage restored)
3. Click again - turns gray, inactive state
4. Check localStorage in DevTools: `localStorage.getItem('starFilter')` shows "true" or "false"
  </verify>
  <done>
Sidebar has star filter button, toggles state, saves to localStorage, restores on load.
  </done>
</task>

<task type="auto">
  <name>Implement client-side filtering in MyDayPage</name>
  <files>client/src/pages/MyDayPage.jsx</files>
  <action>
Add client-side filtering logic to show only starred tasks when filter active.

Implementation:
- Read filter state from localStorage in useState:
  ```javascript
  const [starFilter, setStarFilter] = useState(() => {
    return localStorage.getItem('starFilter') === 'true';
  });
  ```
- Listen to localStorage changes (for cross-tab sync):
  ```javascript
  useEffect(() => {
    const handleStorageChange = (e) => {
      if (e.key === 'starFilter') {
        setStarFilter(e.newValue === 'true');
      }
    };
    window.addEventListener('storage', handleStorageChange);
    return () => window.removeEventListener('storage', handleStorageChange);
  }, []);
  ```
- Filter tasks before rendering:
  ```javascript
  const filteredTasks = tasks.filter(task => {
    if (starFilter) {
      // Show only starred tasks, exclude completed
      return task.is_starred === 1 && task.status !== 'completed';
    }
    return true; // Show all when filter inactive
  });
  ```
- Use `filteredTasks` instead of `tasks` for rendering

Why this approach:
- Client-side filtering is fast (no API call needed per REQUIREMENTS.md STAR-FILT-07)
- localStorage storage event enables cross-tab synchronization
- Filter excludes completed tasks automatically per REQUIREMENTS.md STAR-FILT-05
- Lazy useState initialization reads localStorage only once on mount
  </action>
  <verify>
Test flow:
1. Star 3 tasks, leave 2 unstarred
2. Click sidebar star filter
3. Verify only 3 starred tasks visible (unstarred hidden)
4. Complete 1 starred task
5. Verify only 2 starred tasks visible (completed excluded even though starred)
6. Click filter again - all tasks reappear (including completed)
  </verify>
  <done>
MyDayPage filters tasks by star status, excludes completed tasks from starred filter.
  </done>
</task>

<task type="auto">
  <name>Implement filtering in AllTasksPage and HistoryPage</name>
  <files>client/src/pages/AllTasksPage.jsx, client/src/pages/HistoryPage.jsx</files>
  <action>
Apply same filtering logic to AllTasksPage and HistoryPage for global consistency.

Implementation:
- Copy exact filtering logic from MyDayPage (localStorage state + storage event listener)
- AllTasksPage: Filter `tasks` array before rendering
- HistoryPage: Filter `historyTasks` array after existing filters (date, employee, system, location)

Filter logic for both pages:
```javascript
const filteredByStars = tasksToFilter.filter(task => {
  if (starFilter) {
    // Show only starred tasks, exclude completed
    return task.is_starred === 1 && task.status !== 'completed';
  }
  return true;
});
```

Why this approach:
- Global filter works across ALL pages per CONTEXT.md decision
- Same logic ensures consistent behavior
- HistoryPage applies star filter AFTER other filters (date, employee, etc.)
- Completed task exclusion consistent across all pages
  </action>
  <verify>
Test each page:
1. AllTasksPage: Enable star filter, verify only starred non-completed tasks visible
2. HistoryPage: Enable star filter, apply date filter, verify both filters work together
3. Navigate between pages with filter active - verify filter state persists
4. Open second tab, toggle filter - verify both tabs update
  </verify>
  <done>
Star filter works on all task list pages (MyDay, AllTasks, History), state synchronized globally.
  </done>
</task>

</tasks>

<verification>
Complete filter verification:
1. Start with 5 tasks: 3 starred, 2 unstarred (mix of completed and active)
2. Click sidebar star filter button - turns gold
3. MyDayPage: See only starred non-completed tasks
4. Navigate to AllTasksPage: See same filtered tasks
5. Navigate to HistoryPage: See only starred completed tasks
6. Toggle filter off - all tasks reappear on all pages
7. Refresh browser - filter state restored (localStorage)
8. Open second browser tab:
   - Toggle filter in tab 1
   - See tab 2 updates automatically (storage event)
9. Check localStorage in DevTools: `localStorage.getItem('starFilter')` exists
10. Complete a starred task - verify it disappears from filter even though starred
</verification>

<success_criteria>
- Sidebar has star filter button (icon only, gold when active)
- Filter state persists across page navigation
- Filter state persists across browser refresh (localStorage)
- Filter state syncs across browser tabs (storage event)
- Starred filter shows only is_starred = 1 tasks
- Starred filter excludes completed tasks automatically
- Filter works on MyDayPage, AllTasksPage, HistoryPage
- No performance degradation (client-side filtering is fast)
</success_criteria>

<output>
After completion, create `.planning/phases/01-stars-system/01-03-SUMMARY.md`
</output>
