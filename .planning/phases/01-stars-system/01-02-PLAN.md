---
phase: 01-stars-system
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - client/src/components/shared/TaskCard.jsx
  - client/src/context/AppContext.jsx
autonomous: true

must_haves:
  truths:
    - "User sees star icon on every task card"
    - "Starred tasks show gold filled star"
    - "Unstarred tasks show gray outline star"
    - "Click on star toggles status immediately"
    - "Star status visible in real-time across browser tabs"
  artifacts:
    - path: "client/src/components/shared/TaskCard.jsx"
      provides: "Star icon with click handler"
      min_lines: 20
    - path: "client/src/context/AppContext.jsx"
      provides: "toggleTaskStar method"
      exports: ["toggleTaskStar"]
  key_links:
    - from: "client/src/components/shared/TaskCard.jsx"
      to: "useApp hook"
      via: "toggleTaskStar() call"
      pattern: "toggleTaskStar\\(task\\.id\\)"
    - from: "client/src/context/AppContext.jsx"
      to: "PUT /api/tasks/:id/star"
      via: "fetch API call"
      pattern: "fetch.*tasks.*star"
---

<objective>
Add star icon UI to task cards with real-time toggle functionality

Purpose: Allow managers to visually mark important tasks and see changes across all clients
Output: Interactive star icon on every TaskCard, persisted via API
</objective>

<execution_context>
@c:\dev\projects\claude projects\eden claude\.claude\get-shit-done\workflows\execute-plan.md
@c:\dev\projects\claude projects\eden claude\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@c:\dev\projects\claude projects\eden claude\.planning\PROJECT.md
@c:\dev\projects\claude projects\eden claude\.planning\ROADMAP.md
@c:\dev\projects\claude projects\eden claude\.planning\STATE.md
@c:\dev\projects\claude projects\eden claude\.planning\phases\01-stars-system\01-CONTEXT.md

# Dependencies from Plan 01
@c:\dev\projects\claude projects\eden claude\.planning\phases\01-stars-system\01-01-SUMMARY.md

# Existing frontend patterns
@c:\dev\projects\claude projects\eden claude\client\src\components\shared\TaskCard.jsx
@c:\dev\projects\claude projects\eden claude\client\src\context\AppContext.jsx
</context>

<tasks>

<task type="auto">
  <name>Add toggleTaskStar method to AppContext</name>
  <files>client/src/context/AppContext.jsx</files>
  <action>
Add toggleTaskStar method to AppContext for star toggle API calls.

Implementation:
- Add method after `updateTaskStatus` (line 168)
- Call `PUT ${API_URL}/tasks/${id}/star`
- No request body needed (toggle happens server-side)
- After successful response, call `fetchTasks()` to refresh
- Throw error on failure for TaskCard to display

Why this approach:
- Follows existing pattern from updateTaskStatus (lines 168-177)
- fetchTasks() triggers WebSocket update via Socket.IO listener (line 64)
- Error thrown allows TaskCard to show alert() to user
- No optimistic update - WebSocket provides real-time sync

Export in context value:
- Add `toggleTaskStar` to value object (line 383-430)
  </action>
  <verify>
Run `npm run dev` in client directory.
Open browser console, test: `useApp().toggleTaskStar(1)` - should toggle star and refresh tasks.
  </verify>
  <done>
AppContext exports toggleTaskStar method, calls API, handles success/error.
  </done>
</task>

<task type="auto">
  <name>Add star icon to TaskCard component</name>
  <files>client/src/components/shared/TaskCard.jsx</files>
  <action>
Add star icon to top-right corner of TaskCard with toggle on click.

Implementation details:
- Import FaStar (filled) and FaRegStar (outline) from react-icons/fa (already imported library)
- Position star in top-right corner of card (line 189 - after h3 title, before action buttons)
- Conditional icon: `task.is_starred === 1 ? <FaStar /> : <FaRegStar />`
- Gold color for starred: `text-yellow-500` (Tailwind class)
- Gray color for unstarred: `text-gray-400`
- Click handler: `onClick={handleStarClick}` (create new handler)
- Prevent event bubbling: `e.stopPropagation()` so card doesn't open
- Size: `text-xl` (20px) or `text-2xl` (24px) - choose what fits layout

Handler implementation:
```javascript
const handleStarClick = async (e) => {
  e.stopPropagation(); // Prevent card click
  try {
    await toggleTaskStar(task.id);
  } catch (error) {
    alert('שגיאה: ' + error.message);
  }
};
```

Why this approach:
- FaStar/FaRegStar already available from react-icons/fa (used elsewhere in TaskCard)
- Positioned near title for prominence (top-right RTL layout)
- stopPropagation prevents card opening when starring
- Existing error handling pattern with alert() (lines 77, 113, 124, etc.)
- Yellow-500 is standard "gold" color in Tailwind, matches "important" semantics
  </action>
  <verify>
Test in browser:
1. Navigate to "My Day" page
2. See gray outline star on unstarred tasks
3. Click star - should turn gold immediately
4. Click again - should turn gray
5. Refresh page - star state persists
6. Open second browser tab - star changes appear in both tabs in real-time
  </verify>
  <done>
Every task card shows star icon (gold if starred, gray if not), clicking toggles state, changes broadcast via WebSocket.
  </done>
</task>

</tasks>

<verification>
Full user flow test:
1. Start client and server
2. Navigate to My Day page
3. Verify all task cards show gray outline stars by default
4. Click star on one task - turns gold immediately
5. Open DevTools Network tab - see PUT request to /api/tasks/:id/star
6. Open DevTools Console - see WebSocket event 'task:updated' logged
7. Open second browser tab - see same task's star is gold
8. Toggle star in tab 2 - see change in tab 1 immediately
9. Refresh browser - star state persists
10. Check History page - starred tasks show gold star (visible after completion)
</verification>

<success_criteria>
- Star icon visible on all task cards (TaskCard component)
- Gold filled star for is_starred = 1
- Gray outline star for is_starred = 0
- Click toggles state via API call
- Real-time updates across all browser tabs via WebSocket
- Star state persists across page refresh
- No impact on existing task card functionality (edit, delete, send, etc.)
</success_criteria>

<output>
After completion, create `.planning/phases/01-stars-system/01-02-SUMMARY.md`
</output>
